<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>双开仓套利策略模拟器 - 新手引导</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 0; padding: 0; line-height: 1.7; background-color: #f8f9fa; color: #333; }
        .container { max-width: 800px; margin: 20px auto; padding: 30px; background-color: #fff; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h1, h2, h3 { color: #007bff; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-top: 30px;}
        h1 { text-align: center; }
        p { margin-bottom: 15px; }
        ul, ol { margin-left: 20px; margin-bottom: 15px; }
        li { margin-bottom: 8px; }
        code { background-color: #e9ecef; padding: 2px 6px; border-radius: 4px; font-family: monospace; }
        strong { color: #495057; }
        .diagram { background-color: #f8f9fa; border: 1px dashed #ccc; padding: 15px; margin: 20px 0; text-align: center; font-family: monospace; white-space: pre; overflow-x: auto; border-radius: 5px;}
        .example { border-left: 4px solid #007bff; padding-left: 15px; margin: 20px 0; background-color: #e7f3ff; padding: 15px; border-radius: 5px;}
        .warning { background-color: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 20px 0; border-radius: 5px;}
        a { color: #007bff; text-decoration: none; }
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>

<div class="container">
    <h1>双开仓套利策略模拟器 - 新手引导 🧭</h1>

    <p>欢迎使用双开仓套利策略模拟器！本工具旨在帮助你理解一种特殊的交易策略，并通过模拟历史或假设的价格数据来观察其潜在表现。这篇引导将用最简单的方式为你解惑。</p>

    <h2>一、策略核心思想 🤔</h2>

    这个策略有点特别，它不像普通买卖那样只赌单边方向（只做多或只做空），而是**同时持有相同数量的多单和空单**。这听起来可能有点奇怪，但它有独特的目的。

    <h3>1. 为什么要“多空双开”？🤝</h3>
    <p>想象一下，你出门既带了伞（防下雨 - 价格下跌）又带了遮阳帽（防日晒 - 价格上涨）。无论天气（价格）怎么剧烈变化，你都不会因为方向猜错而措手不及。</p>
    <p>多空双开的核心目的就是**对冲掉大部分价格方向性风险**。也就是说，理论上：</p>
    <ul>
        <li>当价格上涨时，你的多单会盈利，空单会亏损，两者相互抵消。</li>
        <li>当价格下跌时，你的空单会盈利，多单会亏损，两者也相互抵消。</li>
    </ul>
    <p>这样一来，策略的重心就不再是预测价格的涨跌方向，而是转向从其他方面获取利润。</p>
    <div class="diagram">
[图示1：价格与盈亏关系]

      价格 ^
           |        / (多单盈利)
           |       /
           |      /
           |-----/--------> (价格)
           |    / \
           |   /   \
           |  /     \ (空单盈利)
           | /
    -------------------------
    合计盈亏 |---------------> (价格)  (理想情况下是平的，不受价格影响)
    </div>

    <h3>2. 主要利润来源是什么？💰</h3>
    <p>既然价格本身的涨跌被对冲了，利润从哪里来呢？主要有两个（理论上的）来源：</p>

    <h4>a) 资金费率 (Funding Rate) 🏦</h4>
    <p>在永续合约交易中，交易所为了让合约价格贴近现货价格，会设置一个“资金费率”机制。简单说，就像持仓要交“租金”一样，有时你需要支付费用，有时你能收到费用。</p>
    <ul>
        <li>通常，当市场看涨情绪浓厚时，做多的人需要支付资金费给做空的人（资金费率为正）。</li>
        <li>反之，当市场看跌情绪浓厚时，做空的人需要支付资金费给做多的人（资金费率为负）。</li>
    </ul>
    <p>这个策略的一个盈利思路就是：**在资金费率长期有利于某个方向（比如长期为正，空单能收费）的情况下，通过持有对冲仓位来稳定地赚取净资金费收入。**</p>
    <p class="note"><strong>注意：</strong> 模拟器中假设了一个固定的正资金费收入 (+5 USD/8小时)。真实市场的资金费率是波动的，可能是正也可能是负，这是该策略的重要风险点。</p>

    <h4>b) 波动捕捉 (Volatility Capture / 小网格) 🎣</h4>
    <p>这是另一个辅助的盈利方式。想象你在一个价格点（比如 90k）建立了多空双开的核心仓位（像一个大本营）。你认为价格短期内可能会围绕这个点上下波动。</p>
    <p>于是，你在价格稍微偏离这个点一定距离（比如 ±2k）时，进行小规模的反向操作，像撒下小渔网：</p>
    <ul>
        <li><strong>价格上涨到 92k 时：</strong> 你觉得价格“相对高”了，可能会回调。这时就**额外开一笔小的空单**（比如 0.05 BTC）。目标是等价格**跌回 90k** 时平掉这个小空单，赚取 92k 到 90k 这段差价。</li>
        <li><strong>价格下跌到 88k 时：</strong> 你觉得价格“相对低”了，可能会反弹。这时就**额外开一笔小的多单**（比如 0.05 BTC）。目标是等价格**涨回 90k** 时平掉这个小多单，赚取 88k 到 90k 这段差价。</li>
    </ul>
    <p>核心思想是：**在价格偏离平衡点时，进行小额的、与偏离方向相反的操作，期待价格回归平衡点时获利了结。** 这就像在价格波动中不断“薅羊毛”。</p>
    <div class="diagram">
[图示2：波动捕捉示意]

      价格 ^
           |--------- 92k (触发点: 额外开小空单 S') ---┐
           |                                          | 价格回归
           |--------- 90k (平衡点: 平仓S'/L'获利) <---┘---┐
           |                                              | 价格回归
           |--------- 88k (触发点: 额外开小多单 L') ------┘
           |
    -------------------------------------> 时间/步骤
    (核心多单L + 核心空单S 一直持有)
    </div>
    <p class="note"><strong>注意：</strong> 模拟器最新版采用了精确 P&L 逻辑，会跟踪这些小额交易的开平仓和盈亏。</p>

    <h2>二、风险控制 🛡️</h2>
    <p>这个策略内置了一些风险控制机制：</p>
    <ul>
        <li><strong>核心对冲：</strong> 多空双开本身就大大降低了方向性风险。</li>
        <li><strong>最大偏离限制：</strong> 模拟器限制了波动捕捉操作能积累的最大额外仓位（例如，最多额外增加 0.5 BTC 多单或 0.3 BTC 空单），防止在单边波动中仓位失控。</li>
        <li><strong>最终平仓结算：</strong> 模拟结束后，会将所有剩余仓位（核心仓位+网格仓位）按最后一个价格平仓，计算最终总盈亏，让你了解整个策略周期的结果。</li>
    </ul>
    <p class="warning"><strong>重要提示：</strong> 模拟是简化的。真实交易中，你需要考虑更全面的风险管理，例如设置整体止损、管理杠杆、应对极端市场事件（黑天鹅）等。</p>

    <h2>三、如何使用模拟器 🛠️</h2>

    1.  <strong>初始/平衡价格 (Initial Price):</strong> 设定你策略开始时的价格，也是波动捕捉参考的中心点。
    2.  <strong>网格间距/阈值 (Volatility Threshold):</strong> 设定价格偏离平衡点多少美元时触发波动捕捉交易。例如，设为 2000，初始价 90000，则在 92000 会考虑开空，在 88000 会考虑开多。
    3.  <strong>价格走向 (Price Sequence JSON):</strong> 这是关键输入。你需要提供一个 JSON 格式的数字数组，代表你想模拟的价格变化路径。
        * 格式: `[价格1, 价格2, 价格3, ...]`
        * 例如: `[90000, 91000, 89000, 92000, 90000]`
        * 你可以粘贴真实的历史数据（处理成这种格式），或者自己编造一个价格序列来测试特定场景。
    4.  <strong>运行与导出:</strong>
        * 点击 **“运行模拟”** 按钮，下方的图表和表格就会显示结果。
        * 点击 **“导出输入”** 可以将你设置的价格和阈值复制到剪贴板。
        * 点击 **“导出日志”** 可以将详细的模拟步骤表格数据（CSV格式）复制到剪贴板，方便你在 Excel 等工具中进一步分析。

    <h2>四、解读结果 📊📈</h2>

    模拟运行后，你会看到以下结果：

    * <strong>图表一：仓位价值 (USD) 与 价格 (含开仓标记)</strong>
        * 展示你的多单和空单持仓对应的**美元价值**随时间（步骤）的变化。
        * 同时用虚线展示**价格**的走势。
        * 价格线上会有**绿色向上箭头（▲）**表示在该点触发了网格买入开仓，**红色向下箭头（▼）**表示触发了网格卖出开仓。帮你直观了解交易点。
    * <strong>图表二：收益分析 (USD)</strong>
        * **累计权益变化 (蓝色):** 这是最重要的曲线，显示你的**账户总价值相对于初始状态的变化**。它是下面几项的总和。
        * **累计波动P&L (绿色):** 显示通过波动捕捉（网格）操作**实际实现**的利润累积情况。
        * **累计资金费 (青色):** 显示累积收到的（或支付的）资金费。
        * **累计手续费 (红色):** 显示累积支付的手续费（以负数形式展示其对权益的减少）。
        * 这个图表帮助你理解最终权益变化的**来源构成**。
    * <strong>图表三：BTC仓位数量变化</strong>
        * 展示你的**总多单持有量 (BTC)**、**总空单持有量 (BTC)** 以及**净头寸 (BTC)** 随时间的变化。
        * 这个图表让你清晰地看到每次波动捕捉操作是如何增减你的BTC数量的。
    * <strong>详细日志表格:</strong>
        * 记录了**每一步**的价格、仓位数量、资金费、当步实现的盈亏、当步手续费、累计权益变化以及具体的操作说明。这是最详细的数据记录。
    * <strong>结果汇总:</strong>
        * 提供模拟结束时（包含最终平仓后）的关键数据总结，如最终权益变化、各项累计 P&L、最终持仓（应为0）等。

    <h2>五、注意事项 ⚠️</h2>
    <ul>
        <li><strong>模拟 vs 现实：</strong> 模拟是理想化的，忽略了真实交易中的滑点、盘口深度、精确的资金费率波动、交易所规则差异等。结果仅供参考。</li>
        <li><strong>参数敏感：</strong> 策略表现对初始价格、阈值大小、手续费率、资金费率假设等参数非常敏感。建议多尝试不同参数组合。</li>
        <li><strong>非投资建议：</strong> 本模拟器和引导说明仅为教育和演示目的，不构成任何投资建议。请基于自己的判断和风险承受能力进行决策。</li>
    </ul>

    <hr style="margin: 30px 0;">
    <p style="text-align: center;">希望这份引导能帮助你更好地理解和使用这个模拟器！祝你探索愉快！</p>
    </div>

</body>
</html>